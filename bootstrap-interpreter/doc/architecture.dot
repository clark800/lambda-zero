// to build this diagram, install graphviz and run the following command:
// dot -o architecture.pdf -T pdf architecture.dot
// note: ordering=out seems to be not working due to a bug in graphviz
digraph graphname {
    size=6;
    ranksep=1.2;
    nodesep=0.8;
    mclimit=100;

    subgraph cluster_interpreter {
        label="interpreter";
        subgraph cluster_parser {
            label="parser";
            parse;
            lex;
            scan;
            operands;
            operators;
            define;
            brackets;
            patterns;
            bind;
        }
        ast;
        print;
        debug;
        errors;
        subgraph cluster_evaluator {
            label="evaluator";
            evaluate;
            builtins;
        }
        closure;
        serialize;
        main;
    }

    print -> ast;

    errors -> ast;
    errors -> print;

    debug -> ast;
    debug -> print;
    debug -> closure;

    serialize -> ast;
    serialize -> print;
    serialize -> closure;

    closure -> errors;

    lex -> scan;
    lex -> ast;
    lex -> errors;

    bind -> ast;
    bind -> errors;

    patterns -> ast;
    patterns -> errors;

    brackets -> ast;
    brackets -> errors;
    brackets -> operators;

    define -> ast;
    define -> errors;
    define -> patterns;

    operands -> ast;
    operands -> errors;

    operators -> ast;
    operators -> scan;
    operators -> errors;
    operators -> define;
    operators -> patterns;
    operators -> brackets;

    parse -> ast;
    parse -> errors;
    parse -> lex;
    parse -> operands;
    parse -> operators;
    parse -> bind;
    parse -> debug;

    builtins -> ast;
    builtins -> errors;
    builtins -> closure;

    evaluate -> ast;
    evaluate -> errors;
    evaluate -> closure;
    evaluate -> builtins;

    main -> closure;
    main -> errors;
    main -> parse;
    main -> evaluate;
    main -> serialize;
}
