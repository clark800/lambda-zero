// to build this diagram, install graphviz and run the following command:
// dot -o architecture.pdf -T pdf architecture.dot
// note: ordering=out seems to be not working due to a bug in graphviz
digraph graphname {
    size=6;
    ranksep=1.2;
    nodesep=0.8;
    mclimit=100;

    subgraph cluster_interpreter {
        label="interpreter";
        subgraph cluster_parser {
            label="parser";
            parse;
            lex;
            symbols;
            syntax;
            define;
            brackets;
            patterns;
            bind;
        }
        ast;
        print;
        debug;
        errors;
        subgraph cluster_evaluator {
            label="evaluator";
            evaluate;
            builtins;
        }
        closure;
        serialize;
        main;
    }

    errors -> print;

    debug -> ast;
    debug -> print;

    serialize -> ast;
    serialize -> print;
    serialize -> closure;

    bind -> ast;
    bind -> errors;

    patterns -> ast;
    patterns -> errors;

    brackets -> ast;
    brackets -> errors;
    brackets -> symbols;

    define -> ast;
    define -> errors;
    define -> patterns;

    symbols -> ast;
    symbols -> errors;

    syntax -> ast;
    syntax -> errors;
    syntax -> symbols;
    syntax -> patterns;
    syntax -> define;
    syntax -> brackets;

    parse -> lex;
    parse -> ast;
    parse -> errors;
    parse -> symbols;
    parse -> syntax;
    parse -> bind;
    parse -> debug;

    builtins -> ast;
    builtins -> errors;
    builtins -> closure;

    evaluate -> ast;
    evaluate -> closure;
    evaluate -> builtins;

    main -> closure;
    main -> errors;
    main -> parse;
    main -> evaluate;
    main -> serialize;
}
